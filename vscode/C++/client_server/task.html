<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>task</title>
</head>
<body>

  <script>
// 创建 WebSocket 连接
const socket = new WebSocket('ws://10.30.0.206:8080');
let hhh = {
  a:1,
  b:2,
  c:{
    d:3,
    // dd: '我想知道what happened,是不是因为字符串太长导致接收不完整，或者还是因为有特殊字符？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？/',
     e:"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png"
  },
  f:5
}
// 当连接建立时执行
socket.onopen = function(event) {
  socket.send(JSON.stringify({
        type : "2",
        email : user.email,
        password :  user.password,
        name : "User_" + user.email,
        avatar_url : "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png",
        user_id : user.user_id,
        token : user.token,
      }))
  console.log('WebSocket连接已建立');
  // const task = setInterval(()=>{
  //   socket.send(JSON.stringify(hhh))
  // }, 500)
};

// 当收到消息时执行
socket.onmessage = function(event) {
  console.log('收到消息', event.data)
  const message = JSON.parse(event.data);
  // socket.send('task')
  console.log(message);
  // clearInterval(task)

};

// 当连接关闭时执行
socket.onclose = function(event) {
  if (event.wasClean) {
    console.log('WebSocket连接已正常关闭');
  } else {
    console.log('WebSocket连接意外关闭'); // 连接意外关闭时打印错误信息
    console.log('错误码：', event.code);
    console.log('原因：', event.reason);
  }
};

// 当连接发生错误时执行
socket.onerror = function(error) {
  console.error('WebSocket连接发生错误：', error);
};
  </script>
</body>
</html>